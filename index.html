<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å…¨çƒæŒ‡æ•°çœ‹æ¿</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2f;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    h2 {
      margin: 0;
      color: #ffffff;
    }
    #last-updated {
      font-size: 0.9em;
      color: #bbbbbb;
    }
    .section {
      margin-bottom: 40px;
    }
    .section h3 {
      border-left: 5px solid #4cafef;
      padding-left: 10px;
      margin-bottom: 15px;
      color: #ffffff;
    }
    .card {
      background: #2a2a40;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .index-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .index-name {
      font-size: 1.2em;
      font-weight: bold;
    }
    .change {
      font-size: 1em;
      font-weight: bold;
    }
    .up {
      color: #ff4d4f;
    }
    .down {
      color: #29a329;
    }
    .price {
      font-size: 1.4em;
      margin: 8px 0;
    }
    .range {
      font-size: 0.9em;
      color: #bbbbbb;
    }
    .chart {
      width: 100%;
      height: 200px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h2>ğŸŒ å…¨çƒæŒ‡æ•°çœ‹æ¿</h2>
    <div id="last-updated"></div>
  </header>

  <div id="content"></div>

  <script>
    async function loadData() {
      try {
        const response = await fetch("data.json?_t=" + Date.now()); // é˜²ç¼“å­˜
        const data = await response.json();
        const lastUpdated = data["last_updated"];
        document.getElementById("last-updated").innerText = "â° æ›´æ–°æ—¶é—´: " + lastUpdated;

        // æŒ‰ currency åˆ†ç»„
        const groups = {};
        Object.keys(data).forEach(key => {
          if (key === "last_updated") return;
          const info = data[key];
          if (!groups[info.currency]) groups[info.currency] = [];
          groups[info.currency].push({ name: key, ...info });
        });

        // æ¸²æŸ“
        const content = document.getElementById("content");
        content.innerHTML = "";
        for (const currency in groups) {
          const section = document.createElement("div");
          section.className = "section";
          section.innerHTML = `<h3>${currency}</h3>`;
          groups[currency].forEach(info => {
            const card = document.createElement("div");
            card.className = "card";

            const changeClass = info.change_percent >= 0 ? "up" : "down";
            const changeText = (info.change_percent * 100).toFixed(2) + "%";

            card.innerHTML = `
              <div class="index-header">
                <div class="index-name">${info.name || info.region || ""} ${info.name ? "" : ""}${info.name || ""}${info.region ? "" : ""}${Object.keys(data).find(k=>data[k]===info)}</div>
                <div class="change ${changeClass}">${changeText}</div>
              </div>
              <div class="price">${info.current_price.toFixed(2)} ${info.currency}</div>
              <div class="range">52å‘¨é«˜: ${info.fifty_two_week_high ? info.fifty_two_week_high.toFixed(2) : "-"} | 52å‘¨ä½: ${info.fifty_two_week_low ? info.fifty_two_week_low.toFixed(2) : "-"}</div>
              <div id="chart-${info.currency}-${info.current_price}" class="chart"></div>
            `;

            section.appendChild(card);

            // ECharts
            const chart = echarts.init(card.querySelector(".chart"));
            chart.setOption({
              backgroundColor: "#2a2a40",
              xAxis: { type: "category", data: ["ä½ç‚¹", "å½“å‰", "é«˜ç‚¹"], axisLine: { lineStyle: { color: "#ccc" } } },
              yAxis: { type: "value", axisLine: { lineStyle: { color: "#ccc" } } },
              series: [{
                data: [
                  info.fifty_two_week_low,
                  info.current_price,
                  info.fifty_two_week_high
                ],
                type: "line",
                smooth: true,
                areaStyle: { opacity: 0.3 }
              }],
              textStyle: { color: "#e0e0e0" }
            });
          });
          content.appendChild(section);
        }
      } catch (err) {
        console.error("åŠ è½½æ•°æ®å¤±è´¥:", err);
      }
    }

    loadData();
    setInterval(loadData, 60000); // æ¯åˆ†é’Ÿåˆ·æ–°
  </script>
</body>
</html>
