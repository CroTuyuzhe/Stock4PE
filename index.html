<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>全球主要指数监控</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      display: flex;
      justify-content: space-between;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-right: 20px;
    }
    .info h2 {
      margin: 0;
      font-size: 20px;
    }
    .info p {
      margin: 6px 0;
      font-size: 14px;
    }
    .chart {
      flex: 2;
      height: 200px;
    }
  </style>
</head>
<body>
  <h1>📊 全球主要指数监控</h1>
  <div class="container" id="dashboard"></div>

  <script>
    async function loadData() {
      const res = await fetch("data.json"); // 读取本地生成的 JSON
      const data = await res.json();
      const container = document.getElementById("dashboard");
      container.innerHTML = "";

      const regionMap = {
        "CSI300": "中国大陆",
        "SP500": "美国",
        "Nasdaq": "美国",
        "HSI": "中国香港",
        "TWII": "中国台湾"
      };

      Object.entries(data).forEach(([key, val]) => {
        if (key === "last_updated") return;

        // 卡片元素
        const card = document.createElement("div");
        card.className = "card";

        // 左侧信息
        const info = document.createElement("div");
        info.className = "info";
        info.innerHTML = `
          <h2>${key}</h2>
          <p>地区：${regionMap[key] || "未知"}</p>
          <p>现价：${val.price} ${val.currency}</p>
          <p>PE：${val.pe ?? "暂无数据"}</p>
          <p>52周区间：${val.year_low} ~ ${val.year_high}</p>
        `;

        // 右侧图表
        const chartDiv = document.createElement("div");
        chartDiv.className = "chart";
        chartDiv.id = "chart-" + key;

        card.appendChild(info);
        card.appendChild(chartDiv);
        container.appendChild(card);

        // ECharts 绘制
        const chart = echarts.init(chartDiv);
        chart.setOption({
          tooltip: { trigger: "axis" },
          xAxis: {
            type: "category",
            data: ["52周低点", "现价", "52周高点"],
          },
          yAxis: { type: "value" },
          series: [
            {
              name: key,
              type: "line",
              smooth: true,
              data: [val.year_low, val.price, val.year_high],
              lineStyle: { color: "#5470c6" },
              itemStyle: { color: "#91cc75" }
            }
          ]
        });
      });
    }

    loadData();
  </script>
</body>
</html>
